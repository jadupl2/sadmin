#! /usr/bin/env sh
# --------------------------------------------------------------------------------------------------
#   Author      :   Jacques Duplessis
#   Title       :   sadm_df.sh
#   Version     :   1.0
#   Date        :   05/05/2016
#   Requires    :   sh 
#   Description :   Display Disk Usage (df) with a more formatted output
#
#   Note        :   All scripts (Shell,Python,php) and screen output are formatted to have and use 
#                   a 100 characters per line. Comments in script always begin at column 73. You 
#                   will have a better experience, if you set screen width to have at least 100 Chr.
# 
# --------------------------------------------------------------------------------------------------
#
#   This code was originally written by Jacques Duplessis <jacques.duplessis@sadmin.ca>.
#   Developer Web Site : http://www.sadmin.ca
#
#   The SADMIN Tool is free software; you can redistribute it and/or modify it under the terms
#   of the GNU General Public License as published by the Free Software Foundation; either
#   version 2 of the License, or (at your option) any later version.
#
#   SADMIN Tools are distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
#   without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
#   See the GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License along with this program.
#   If not, see <http://www.gnu.org/licenses/>.
# 
# --------------------------------------------------------------------------------------------------
# CHANGELOG
#
# 2016_05_05    V1.0 Initial Version
# 2018_06_04    V1.1 Include Filesystem Type, Sorted by Mount Point, Better, clearer Output.
#
# --------------------------------------------------------------------------------------------------



#===================================================================================================
# Scripts Variables 
#===================================================================================================
export SADM_VER='1.1'                                       # Current Script Version
SADM_80DASH=`printf %100s |tr " " "="`                      # 100 equals sign line
DEBUG_LEVEL=0                                               # 0=NoDebug Higher=+Verbose
file="/tmp/sdf_tmp1.$$"                                     # File Contain Result of df
data="/tmp/sdf_tmp2.$$"                                     # Contain df data (No Heading, no Total)
export SADM_PN=${0##*/}                                     # Current Script name



#===================================================================================================
#                                       Script Start HERE
#===================================================================================================
    
# Display Filesystem Disk Space Usage in Human output and in a column fashion
df -ThP --total |awk '{printf "%-35s %-8s %-8s %-8s %-8s %-8s %-30s\n", $1, $2, $3, $4, $5, $6, $7'}> $file
lines=`wc -l $file | awk '{print $1}'`                      # Total Lines in file
ntail=`expr $lines - 1`                                     # Calc. tail Number to use
nhead=`expr $ntail - 1`                                     # Calc. head Number to use
title=`head -1 $file`                                       # Save 'df' Title Line
total=`tail -1 $file`                                       # Save 'df' Total Line
tail -${ntail} $file | head -${nhead}|sort -k7 > $data      # Sort by MntPoint 

tput clear
if [ "$DEBUG_LEVEL" -gt 0 ] 
    then echo "Number of lines      : $lines"
         echo "Number of tail       : $ntail"
         echo "Number of head       : $nhead"
         echo "Title Line           : $title"
         echo "Total Line           : $total"
         echo "Full df result file  : $file"
         echo "Data Part of df      : $data"
         echo "Data part of df      :"
         cat $data
fi
printf "${SADM_PN} - v${SADM_VER}\n"
printf "${SADM_80DASH}\n"
printf "%s\n" "$title"
printf "${SADM_80DASH}\n"
cat ${data}
printf "${SADM_80DASH}\n"
printf "%s\n" "$total"

# Remove work files
rm -f $file >/dev/null 2>&1
rm -f $data >/dev/null 2>&1

